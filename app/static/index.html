<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Kia-Ai - WhatsApp Management Interface</title>
    <link rel="icon" type="image/png" sizes="32x32" href="https://hotboatchile.com/wp-content/uploads/cropped-Screenshot_3-32x32.jpg">
    <link rel="icon" type="image/png" sizes="192x192" href="https://hotboatchile.com/wp-content/uploads/cropped-Screenshot_3-192x192.jpg">
    <link rel="apple-touch-icon" href="https://hotboatchile.com/wp-content/uploads/cropped-Screenshot_3-180x180.jpg">
    <meta property="og:title" content="HotBoat WhatsApp Interface">
    <meta property="og:description" content="Gestiona tus conversaciones de HotBoat Chile desde la interfaz de WhatsApp.">
    <meta property="og:image" content="https://hotboatchile.com/wp-content/uploads/cropped-Screenshot_3-192x192.jpg">
    <meta property="og:url" content="https://hotboat-whatsapp-production.up.railway.app">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="/static/styles.css?v=20260124unread2">
    <link rel="stylesheet" href="/static/mobile-fix.css?v=20260117g">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>ğŸ¤– Kia-Ai</h1>
                <p class="subtitle">WhatsApp Management Interface</p>
            </div>
            <div class="status">
                <span class="status-indicator connected" id="statusIndicator"></span>
                <span id="statusText">Connected</span>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar: Conversations List -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>ğŸ’¬ Conversations</h2>
                    <button class="btn-refresh" onclick="loadConversations()" title="Refresh">
                        ğŸ”„
                    </button>
                    <button class="btn-secondary sidebar-close-button" onclick="showChatView()">
                        âœ•
                    </button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchConversations" placeholder="Search conversations..." onkeyup="filterConversations()">
                </div>

                <div class="conversations-list" id="conversationsList">
                    <!-- Conversations will be loaded here -->
                </div>
            </aside>

            <!-- Chat Area -->
            <main class="chat-area">
                <div class="chat-header" id="chatHeader">
                    <div class="chat-info">
                        <h3 id="currentChatName">Select a conversation</h3>
                        <p id="currentChatPhone"></p>
                    </div>
                    <div class="chat-actions">
                    <button class="btn-secondary mobile-back-button" onclick="showConversationList()">
                        â† Conversaciones
                    </button>
                        <button class="btn-secondary" onclick="showNewMessageModal()">
                            â• New Message
                        </button>
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="welcome-message">
                        <h2>ğŸ‘‹ Welcome to Kia-Ai</h2>
                        <p>Select a conversation from the left to view messages</p>
                        <p>or click "New Message" to send a custom message</p>
                    </div>
                </div>

                <div class="message-input-area" id="messageInputArea" style="display: none;">
                    <form onsubmit="sendMessage(event)" id="messageForm">
                        <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                            <button type="button" class="btn-attachment" onclick="document.getElementById('imageFileInput').click()" title="Adjuntar imagen">
                                ğŸ“
                            </button>
                            <button type="button" class="btn-attachment btn-microphone" id="microphoneButton" onclick="toggleAudioRecording()" title="Grabar audio">
                                ğŸ¤
                            </button>
                            <textarea 
                                id="messageInput" 
                                placeholder="Type your message..." 
                                rows="3"
                                maxlength="4096"
                                style="flex: 1;"
                            ></textarea>
                        </div>
                        <div id="audioRecordingStatus" style="display: none; margin-top: 0.5rem; padding: 0.5rem; background: var(--bg-light); border-radius: 8px; text-align: center;">
                            <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                <span class="recording-indicator"></span>
                                <span id="recordingTime">0:00</span>
                                <button type="button" onclick="stopAudioRecording()" class="btn-secondary" style="margin-left: 1rem;">
                                    â¹ï¸ Detener
                                </button>
                                <button type="button" onclick="cancelAudioRecording()" class="btn-secondary">
                                    âŒ Cancelar
                                </button>
                            </div>
                        </div>
                        <div id="audioPreview" style="display: none; margin-top: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: var(--bg-light); border-radius: 8px;">
                                <span>ğŸ¤</span>
                                <audio id="audioPreviewPlayer" controls style="flex: 1; max-width: 200px;"></audio>
                                <button type="button" onclick="clearAudioRecording()" class="btn-secondary">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <input 
                            type="file" 
                            id="imageFileInput" 
                            accept="image/*"
                            style="display: none;"
                            onchange="handleImageFileSelect(event)"
                        >
                        <div id="imagePreview" style="display: none; margin-top: 0.5rem; position: relative;">
                            <img id="previewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                            <button type="button" onclick="clearImageSelection()" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">âœ•</button>
                        </div>
                        <div class="input-actions">
                            <div class="char-counter">
                                <span id="charCount">0</span>/4096
                            </div>
                            <div class="bot-toggle-section">
                                <label class="bot-toggle-label">
                                    <input 
                                        type="checkbox" 
                                        id="botToggleCheckbox" 
                                        checked 
                                        onchange="toggleBotFromInput(this.checked)"
                                        class="bot-toggle-input"
                                    >
                                    <span class="bot-toggle-text" id="botToggleText">ğŸ¤– Bot Activo</span>
                                </label>
                            </div>
                            <button type="submit" class="btn-primary" id="sendButton">
                                Send ğŸ“¤
                            </button>
                        </div>
                    </form>
                </div>
            </main>

            <!-- Right Panel: Lead Info -->
            <aside class="right-panel" id="rightPanel">
                <div class="panel-header">
                    <h3>ğŸ‘¤ Lead Information</h3>
                </div>
                <div class="lead-info" id="leadInfo">
                    <p class="no-selection">Select a conversation to view lead details</p>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modal: New Message -->
    <div class="modal" id="newMessageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“± Send New Message</h2>
                <button class="modal-close" onclick="closeNewMessageModal()">&times;</button>
            </div>
            <form onsubmit="sendNewMessage(event)" id="newMessageForm">
                <div class="form-group">
                    <label for="recipientPhone">Phone Number</label>
                    <input 
                        type="text" 
                        id="recipientPhone" 
                        placeholder="56912345678 (with country code, no +)" 
                        required
                        pattern="[0-9]{10,15}"
                    >
                    <small>Format: Country code + number (e.g., 56912345678 for Chile)</small>
                </div>
                <div class="form-group">
                    <label for="newMessageText">Message</label>
                    <div style="display: flex; gap: 0.5rem; align-items: flex-start;">
                        <button type="button" class="btn-attachment" onclick="document.getElementById('newImageFileInput').click()" title="Adjuntar imagen">
                            ğŸ“
                        </button>
                        <textarea 
                            id="newMessageText" 
                            placeholder="Type your message here..." 
                            rows="5"
                            maxlength="4096"
                            style="flex: 1;"
                        ></textarea>
                    </div>
                    <input 
                        type="file" 
                        id="newImageFileInput" 
                        accept="image/*"
                        style="display: none;"
                        onchange="handleNewImageFileSelect(event)"
                    >
                    <div id="newImagePreview" style="display: none; margin-top: 0.5rem; position: relative;">
                        <img id="newPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 8px;">
                        <button type="button" onclick="clearNewImageSelection()" style="position: absolute; top: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">âœ•</button>
                    </div>
                    <small><span id="newMsgCharCount">0</span>/4096 characters</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeNewMessageModal()">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary">
                        Send Message ğŸ“¤
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="/static/app.js?v=20260125audio"></script>
</body>
</html>

